FROM public.ecr.aws/amazonlinux/amazonlinux:latest
 
RUN dnf install python3 aws-cli -y

# Set environment variables
ENV PYTHONUNBUFFERED=1

# Set the working directory in the container
WORKDIR /app

COPY entrypoint . 
RUN chmod 0500 main.py
RUN mkdir /tmp/volume

# Install any required Python dependencies (if needed, update requirements.txt with dependencies)
# RUN pip install -r requirements.txt

# Run the script with the required arguments
CMD [ "python3", "main.py", \
      "--artifact-type=container", \
      "--artifact-path=documents", \
      "--display-vuln-findings=enabled", \
      "--out-sbom=/tmp/volume/sbom.json", \
      "--out-scan=/tmp/volume/inspector_scan_.json", \
      "--out-scan-csv=/tmp/volume/inspector_scan_.csv", \
      "--out-scan-markdown=/tmp/volume/inspector_scan_.md", \
      "--out-dockerfile-scan-csv=/tmp/volume/inspector_dockerfile_scan_.csv", \
      "--out-dockerfile-scan-md=/tmp/volume/inspector_dockerfile_scan_.md", \
      "--sbomgen-version=1.5.5", \
      "--skip-exploit-not-available", \
      "--skip-fixed-ver-not-available"]
