name: "SonarQube"
description: "This action scans the code with SonarQube"
inputs:
  sonar-token:
    description: "SonarQube Token"
    required: true
  sonar-host-url:
    description: "SonarQube Host URL"
    required: true

runs:
  using: composite
  steps:
    - uses: actions/checkout@v4
      with:
        # Disabling shallow clones is recommended for improving the relevancy of reporting
        fetch-depth: 0
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 22
    - name: Get SonarQube Project Name
      id: project-name
      shell: bash
      run: |
        echo "project_name=${GITHUB_REPOSITORY#*/}" >> "$GITHUB_OUTPUT"
    - name: SonarQube Scan
      uses: SonarSource/sonarqube-scan-action@v6.0.0
      env:
        SONAR_TOKEN: ${{ inputs.sonar-token }}
        SONAR_HOST_URL: ${{ inputs.sonar-host-url }}
      with:
        args: >
          -Dsonar.projectName=${{ steps.project-name.outputs.project_name }}
          -Dsonar.projectKey=repository_id:${{ github.repository_id }}